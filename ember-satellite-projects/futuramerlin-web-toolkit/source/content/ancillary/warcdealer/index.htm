<h1 class="title">Warcdealer</h1>

<p class="breadcrumbs">Page location:
    <span><a href="/ancillary/ready-to-use.htm">Software</a></span>
</p>

<p>Warcdealer is an app that uploads Web archive files to the Internet Archive.</p>
<p>It is available <a href="https://github.com/ethus3h/ember/tree/master/ember-satellite-projects/warcdealer">at GitHub</a>.</p>
<p>It can be used with <a href="https://github.com/ludios/grab-site/">grab-site</a> for a complete on-demand Web archival system.</p>
<h2>Usage</h2>
<p><span class="hatnote-emphasis-warning">Before running Warcdealer, <code>cd</code> to the directory that contains or will contain the files you would like uploaded. Note that those should be the only files present in that directory.</span></p>
<figure class="center-figure app-syntax">
    <code>warcdealer</code>
</figure>

<h2>Installation</h2>

<ol>
    <li>Ensure your system has the correct dependencies:
        <ul>
            <li>Requires ia (https://pypi.python.org/pypi/internetarchive) to be installed and to have been configured since being updated to version 1.0.2.</li>
            <li>Requires hashdeep (probably provided in the md5deep package for your system).</li>
            <li>Requires Python 2 installed, and runnable as <code>python2</code>.</li>
            <li>Requires Git (for installing and updating).</li>
            <li>Optionally, Warcdealer can be used with grab-site.</li>
        </ul>
    </li>
    <li>If you have a version of Warcdealer prior to version 3 installed, remove it.</li>
    <li>Figure out as what user Warcdealer should run. If you're using grab-site, this is either the user as which grab-site is running, or <code>root</code>. Otherwise, this is any user with write permission for the files you would like to upload. (<code>root</code> will work in either case.) When you have selected the correct user, substitute it in place of "<code>userName</code>" in the following command, and run the resulting command:<br /><pre><code>echo "userName" > ~/.warcdealer.cfg</code></pre></li>
    <li>Decide at what threshold of free disk space, in gigabytes, you would like uploads to begin. A reasonable default for large disks is "<code>80</code>". When you have decided this, substitute that number in place of "<code>diskThreshold</code>" in the following command, and run the resulting command:<br /><pre><code>echo "diskThreshold" >> ~/.warcdealer.cfg</code></pre></li>
    <li>Figure out what partition you would like to monitor for free disk space (e.g. <code>/</code> for the root partition). When you know this, substitute it in place of "<code>diskMonitorPartition</code>" in the following command, and run the resulting command:<br /><pre><code>echo "diskMonitorPartition" >> ~/.warcdealer.cfg</code></pre></li>
    <li>Decide how frequently, in seconds, you want the free disk space to be checked. A reasonable default is "<code>60</code>". When you have decided this, substitute it in place of "diskCheckInterval" in the following command, and run the resulting command:<br /><pre><code>echo "<code>diskCheckInterval</code>" >> ~/.warcdealer.cfg; set +H</code></pre></li>
    <li>As the user you chose in step 2, run the following command:<br /><pre><code>warcdealerInstallationUUID=$(python2 -c 'import uuid; print str(uuid.uuid4())'); cd ~; mkdir "$warcdealerInstallationUUID"; cd "$warcdealerInstallationUUID"; git clone https://github.com/ethus3h/ember.git; cp ./ember/ember-satellite-projects/warcdealer/warcdealer ~/.warcdealer; chmod +x ~/.warcdealer; echo $(date +%Y-%m-%d-%H-%M-%S-%N)-$(xxd -pu &lt;&lt;&lt; "$(date +%z)") >> ~/.warcdealer.cfg; echo "$warcdealerInstallationUUID" >> ~/.warcdealer.cfg; echo '#!/bin/bash\n\n#Archive a Web site\'s directory recursively\na\\(\\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error\ --tries=1024 "$@"; }\nexport -f a;\n\n#Archive a single Web page:\no\(\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error\ --tries=1024 --1 "$@"; }\nexport -f o;\n\n#Quick recursive archival \(gives up easily on retriable errors; use for urgent jobs to get a quick grab, then run a full archival for thoroughness\)\naq\(\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error "$@"; }\nexport -f aq;\n\n#Quick single archival\noq\(\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error --1 "$@"; }\nexport -f oq;\n\n#Archive using PhantomJS\nap\(\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error\ --tries=1024\ --phantomjs "$@"; }\nexport -f ap;\n\n#Archive single page using PhantomJS\nop\(\) { cd /home/grabbot/grabs/ && grab-site --no-dupespotter --concurrency=5 --wpull-args=--warc-move=/home/grabbot/warcdealer/\ --read-timeout=3600\ --connect-timeout=20\ --dns-timeout=20\ --retry-connrefused\ --retry-dns-error\ --max-redirect=128\ --phantomjs-scroll=50000\ --phantomjs-exe=/phantomjs-1.9.8-linux-x86_64/bin/phantomjs\ --content-on-error\ --tries=1024\ --phantomjs --1 "$@"; }\nexport -f op;\n\n#Start Warcdealer\nwarcdealer\(\) { ~/.warcdealer }\nexport -f warcdealer;\n\n#Quickly upload a file to the Internet Archive \(for emergencies\)\niu\(\) { IUIDENTIFIER=$\(python2 -c \'import uuid; print str\(uuid.uuid4\(\)\)\'\)-$\(date +%Y.%m.%d.%H.%M.%S.%N\)-$\(xxd -pu &lt;&lt;&lt; "$\(date +%z\)"\); ia upload $IUIDENTIFIER --metadata="subject:Uploaded using iu v3; 291E5EDE-6B59-4CB7-8928-375368F5725B" "$@"; echo \'https://archive.org/download/\'$IUIDENTIFIER; }\nexport -f iu;' >> ~/.bash_profile; echo '#!/bin/bash\n. ~/.bash_profile' >> ~/.bashrc; chmod +x ~/.bash_profile; chmod +x ~/.bashrc</code></pre></li>
</ol>

<h2>Updating</h2>
<ol>
    <li>Check for changes to the requirements.</li>
    <li>Check the Warcdealer version. If the major version has changed (the part before the first "." in the version number), follow the current installation instructions instead (unless you know you don't need to, <span class="foreign-text">e.g.</span> if the release notes specify that the configuration file format is compatible with the major version you have installed).</li>
    <li>As the user you chose in step 2 of the installation process, run the following command:<br /><pre><code>warcdealerTemporaryUUID=$(python2 -c 'import uuid; print str(uuid.uuid4())'); cd ~; mkdir "$warcdealerTemporaryUUID"; cd "$warcdealerTemporaryUUID"; git clone https://github.com/ethus3h/ember.git; cp ./ember/ember-satellite-projects/warcdealer/warcdealer ~/.warcdealer; chmod +x ~/.warcdealer;</code></pre></li>
</ol>
